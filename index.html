<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trung Thu Y√™u Th∆∞∆°ng - ƒê√™m ƒê√®n L·ªìng Ho√†n Ch·ªânh</title>
    <style>
        /* CSS cho t·ªïng th·ªÉ trang */
        body {
            background-color: #0d1128; 
            color: #fff;
            margin: 0;
            overflow: hidden; 
            font-family: 'Arial', sans-serif;
        }

        /* CSS cho M·∫∑t TrƒÉng */
        #moon {
            position: absolute; top: 50px; right: 50px; width: 150px; height: 150px; background: #fff; border-radius: 50%; box-shadow: 0 0 80px rgba(255, 255, 200, 0.7), 0 0 150px rgba(255, 255, 180, 0.4); z-index: 1; 
        }

        /* Ng√¥i sao nh·ªè */
        .star {
            position: absolute; width: 2px; height: 2px; background-color: #fff; border-radius: 50%; opacity: 0.5; animation: twinkle 5s infinite alternate; z-index: 0;
        }
        @keyframes twinkle {
            from { opacity: 0.2; } to { opacity: 0.8; }
        }

        /* CSS chung cho L·ªìng ƒê√®n TRANG TR√ç */
        .lantern {
            position: absolute; width: 30px; height: 40px; cursor: pointer; 
            background: radial-gradient(circle at center, #ff8c00 10%, #ff4500 90%);
            border-radius: 50% 50% 40% 40% / 60% 60% 50% 50%;
            box-shadow: 0 0 10px #ff9900, 0 0 5px #ff6600 inset;
            animation: floatUp var(--duration) linear infinite;
            z-index: 5; transform-origin: bottom center; 
        }

        /* Keyframes cho animation bay l√™n T·ªêC ƒê·ªò B√åNH TH∆Ø·ªúNG */
        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            30% { opacity: 1; }
            60% { transform: translateY(40vh) rotate(3deg); }
            100% { transform: translateY(-10vh) rotate(-3deg); opacity: 0; }
        }

        /* --- CSS CHO L·ªíNG ƒê√àN CH·ª®A L·ªúI CH√öC (ƒê·∫∂C BI·ªÜT) --- */
        .wish-lantern {
            width: 45px; height: 60px;
            background: radial-gradient(circle at center, #ffee00 10%, #ff8c00 90%);
            outline: 4px solid #fff; outline-offset: 5px;
            box-shadow: 0 0 25px 8px #fff0b3, 0 0 10px #ff8c00 inset;
            
            animation-name: floatUpSlow, pulseVibrate;
            animation-duration: var(--duration), 0.5s;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: infinite, infinite;
            animation-direction: normal, alternate; 
            z-index: 10;
        }
        
        /* Keyframes cho hi·ªáu ·ª©ng L·ªìng ƒê√®n Ch√∫c M·ª´ng bay CH·∫¨M H∆†N */
        @keyframes floatUpSlow {
            0% { transform: translateY(100vh) rotate(0deg) scale(1); opacity: 0; }
            50% { transform: translateY(50vh) rotate(5deg) scale(1.1); opacity: 1; }
            100% { transform: translateY(-10vh) rotate(-5deg) scale(1.2); opacity: 0; }
        }

        /* Keyframes cho hi·ªáu ·ª©ng RUNG (Vibration) li√™n t·ª•c v√† ph√°t s√°ng */
        @keyframes pulseVibrate {
            0% { filter: brightness(1); transform: scale(1.0) rotate(0deg); }
            50% { transform: scale(1.05) rotate(1deg); }
            100% { filter: brightness(1.8); transform: scale(1.1) rotate(-1deg); }
        }
        /* ----------------------------------------------------- */

        /* CSS cho Ch√∫c M·ª´ng (popup) */
        #message-box {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(255, 255, 255, 0.98); color: #c93b1d; padding: 25px 40px; border-radius: 12px; box-shadow: 0 0 30px rgba(255, 200, 100, 0.9); text-align: center; font-size: 1.6em; font-weight: bold; z-index: 100; display: none; border: 3px solid #ffaa00;
        }
        #close-btn { 
            margin-top: 20px; padding: 8px 20px; background-color: #c93b1d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em;
        }

        /* --- GHI CH√ö V√Ä N√öT NH·∫†C H·ª¢P NH·∫§T --- */
        #instruction-note {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.95);
            color: #c93b1d;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            z-index: 10;
            display: flex;
            align-items: center;
            line-height: 1.5;
        }

        #instruction-note .icon {
            font-size: 1.3em; margin-right: 8px; color: #ffaa00; text-shadow: 0 0 5px #ffaa00;
        }
        
        #combined-music-toggle {
            background-color: #c93b1d; 
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="moon"></div>

    <div id="message-box">
        <p id="wish-text"></p>
        <button id="close-btn">ƒê√≥ng L·ªùi Ch√∫c</button>
    </div>
    
    <div id="instruction-note">
        <span class="icon">üèÆ</span> 
        <span>Nh·ªõ b·∫•m v√†o l·ªìng ƒë√®n ph√°t s√°ng, v√†</span>
        <button id="combined-music-toggle">
            üé∂ B·∫≠t Nh·∫°c L√™n
        </button>
        <audio id="background-music" loop>
            <source src="trungthu.mp3" type="audio/mp3">
        </audio>
    </div>

    <script>
        const WISHES = [
            "Trung Thu vui v·∫ª, ·∫•m √°p b√™n ng∆∞·ªùi th√¢n y√™u!",
            "Ch√∫c b·∫°n s·ª©c kh·ªèe, th√†nh c√¥ng, h·∫°nh ph√∫c vi√™n m√£n.",
            "Nguy·ªán √°nh trƒÉng r·∫±m mang l·∫°i b√¨nh an, may m·∫Øn.",
            "Ch√∫c b·∫°n c√≥ m·ªôt ƒë√™m r·∫±m sum v·∫ßy, an l√†nh.",
            "H·∫°nh ph√∫c tr√≤n ƒë·∫ßy, t√†i l·ªôc ƒë·∫ßy nh√†, Trung Thu an khang.",
            "Trung Thu ƒëo√†n vi√™n! M·ªçi s·ª± nh∆∞ √Ω, v·∫°n ƒëi·ªÅu t·ªët l√†nh.",
            "Ch√∫c gia ƒë√¨nh m√¨nh m√£i m√£i h√≤a thu·∫≠n, y√™u th∆∞∆°ng.",
            "Lu√¥n b√¨nh an, v·ªØng v√†ng v√† g·∫∑t h√°i th√†nh c√¥ng m·ªõi.",
            "T·∫≠n h∆∞·ªüng tr·ªçn v·∫πn h∆∞∆°ng v·ªã b√°nh, ng·∫Øm trƒÉng ƒë·∫πp nh√©!",
            "Ch√∫c b·∫°n lu√¥n r·∫°ng r·ª° nh∆∞ √°nh trƒÉng ƒë√™m nay. ‚ú®",
            "M·ªçi c√¥ng vi·ªác thu·∫≠n l·ª£i, t√¨nh c·∫£m b·ªÅn l√¢u. Happy Mid-Autumn!",
            "G·ª≠i ng√†n l·ªùi ch√∫c y√™u th∆∞∆°ng ƒë·∫øn b·∫°n v√† gia ƒë√¨nh.",
            "Mong b·∫°n lu√¥n gi·ªØ ƒë∆∞·ª£c s·ª± l·∫°c quan, y√™u ƒë·ªùi.",
            "Ch√∫c b·∫°n c√≥ nh·ªØng kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ, √Ω nghƒ©a nh·∫•t.",
            "√Ånh trƒÉng soi r·ªçi, ch√∫c b·∫°n c√≥ th√™m nhi·ªÅu th√†nh t·ª±u.",
            "Trung Thu l√† ƒëo√†n t·ª•. Ch√∫c m·ªçi ng∆∞·ªùi lu√¥n b√™n nhau. ü•Ç",
            "Ch√∫c b·∫°n m·ªôt nƒÉm sung t√∫c, ·∫•m no, m·ªçi ƒëi·ªÅu t·ªët ƒë·∫πp.",
            "Ch√∫c b·∫°n c√≥ m·ªôt ƒë√™m r·∫±m th∆∞ th√°i, kh√¥ng lo √¢u!",
            "S·ª©c kh·ªèe d·ªìi d√†o, ni·ªÅm vui d√¢ng tr√†o. Trung Thu an l√†nh.",
            "Ch√∫c t√¨nh th√¢n, t√¨nh b·∫°n lu√¥n r·ª±c s√°ng nh∆∞ l·ªìng ƒë√®n. üíñ",
        ];

        const WISH_COUNT = WISHES.length; 
        const TOTAL_LANTERNS = 200; 
        
        const availableWishIndices = Array.from({length: WISH_COUNT}, (_, i) => i);
        const WISH_RATIO = WISH_COUNT / TOTAL_LANTERNS;

        /**
         * H√†m t·∫°o v√† th√™m m·ªôt l·ªìng ƒë√®n ng·∫´u nhi√™n v√†o trang
         */
        function createLantern() {
            const lantern = document.createElement('div');
            lantern.className = 'lantern';

            let isWishLantern = availableWishIndices.length > 0 && Math.random() < WISH_RATIO;
            
            const duration = isWishLantern ? (20 + Math.random() * 10) : (12 + Math.random() * 8); 
            const delay = Math.random() * 10; 
            const startLeft = Math.random() * window.innerWidth;
            
            lantern.style.setProperty('--duration', `${duration}s`);
            lantern.style.left = `${startLeft}px`;
            lantern.style.animationDelay = `${delay}s`;

            // L·ªìng ƒë√®n ch·ª©a l·ªùi ch√∫c
            if (isWishLantern) {
                const randomIndex = Math.floor(Math.random() * availableWishIndices.length);
                const wishIndex = availableWishIndices.splice(randomIndex, 1)[0];
                
                lantern.classList.add('wish-lantern');
                lantern.onclick = () => {
                    showWish(WISHES[wishIndex]);
                    availableWishIndices.push(wishIndex); // ƒê∆∞a l·ªùi ch√∫c tr·ªü l·∫°i m·∫£ng

                    lantern.remove();
                    createLantern(); // T·∫°o l·ªìng ƒë√®n m·ªõi thay th·∫ø
                };
            } else {
            // L·ªìng ƒë√®n trang tr√≠
                 lantern.onclick = () => {
                    lantern.style.transform = 'scale(1.5)';
                    setTimeout(() => {
                         lantern.remove();
                         createLantern();
                    }, 200);
                };
            }

            // X√≥a v√† t√°i t·∫°o l·ªìng ƒë√®n khi bay h·∫øt
            lantern.addEventListener('animationend', () => {
                lantern.remove();
                createLantern();
            });

            document.body.appendChild(lantern);
        }

        // T·∫°o 200 l·ªìng ƒë√®n ban ƒë·∫ßu (k√≠ch ho·∫°t h√†m t·∫°o)
        for (let i = 0; i < TOTAL_LANTERNS; i++) {
            createLantern();
        }
        
        // T·∫°o th√™m 20 l·ªìng ƒë√®n ch√∫c m·ª´ng ƒë·ªÉ ƒë·∫£m b·∫£o s·ªë l∆∞·ª£ng xu·∫•t hi·ªán ban ƒë·∫ßu
        for(let i = 0; i < WISH_COUNT; i++) {
            createLantern(); 
        }


        // Logic hi·ªÉn th·ªã l·ªùi ch√∫c
        const messageBox = document.getElementById('message-box');
        const wishText = document.getElementById('wish-text');
        const closeBtn = document.getElementById('close-btn');

        function showWish(wish) {
            wishText.textContent = wish;
            messageBox.style.display = 'block';
        }

        closeBtn.onclick = () => {
            messageBox.style.display = 'none';
        };

        // Logic Ng√¥i Sao
        function createStars() {
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.top = `${Math.random() * 100}vh`;
                star.style.left = `${Math.random() * 100}vw`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                document.body.appendChild(star);
            }
        }
        createStars();


        // LOGIC T·ª∞ ƒê·ªòNG PH√ÅT NH·∫†C
        const music = document.getElementById('background-music');
        const musicToggle = document.getElementById('combined-music-toggle');
        let isPlaying = false;

        function checkAndPlayMusic() {
            music.volume = 0.5; 
            music.play().then(() => {
                isPlaying = true;
                musicToggle.innerHTML = 'üé∂ ƒêang Ph√°t';
                musicToggle.disabled = true;
            }).catch(error => {
                musicToggle.innerHTML = 'üé∂ B·∫≠t Nh·∫°c L√™n';
            });
        }

        window.onload = checkAndPlayMusic;

        musicToggle.onclick = () => {
            if (!isPlaying) {
                music.play().then(() => {
                    isPlaying = true;
                    musicToggle.innerHTML = 'üé∂ ƒêang Ph√°t';
                    musicToggle.disabled = true; 
                }).catch(error => {
                    alert("Kh√¥ng th·ªÉ ph√°t nh·∫°c. Vui l√≤ng ki·ªÉm tra file trungthu.mp3.");
                });
            }
        };

        music.onpause = () => {
            if (music.currentTime > 0 && !music.ended) {
                isPlaying = false;
                musicToggle.innerHTML = 'üé∂ T·∫°m D·ª´ng';
                musicToggle.disabled = false;
            }
        };
        
        music.onplay = () => {
            isPlaying = true;
            musicToggle.innerHTML = 'üé∂ ƒêang Ph√°t';
            musicToggle.disabled = true;
        }
    </script>
</body>
</html>